@page "/project/{id:guid}"

@using BuildHub.App.Compliant.Application.Models
@using BuildHub.App.Compliant.Application.Services

@inject ISnackbar Snackbar

<PageTitle>Project Details</PageTitle>

@if (_complianceProject is null)
{
    <Loading />
}
else
{
    
    <MudContainer MaxWidth="MaxWidth.Large">
        <MudGrid Spacing="3" Class="mt-4">
            <!-- Project Information Section -->
            <MudItem xs="12">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.h5">Project Information</MudText>
                    <MudGrid Spacing="3" Class="mt-3">
                        <MudItem xs="12" sm="6">
                            <MudText Typo="Typo.h6">Project Name:</MudText>
                            <MudText Typo="Typo.body1">@_complianceProject.Reference</MudText>
                        </MudItem>
                        <MudItem xs="12" sm="6">
                            <MudText Typo="Typo.h6">Description:</MudText>
                            <MudText Typo="Typo.body1">@_complianceProject.Overview</MudText>
                        </MudItem>
                        <MudItem xs="12" sm="6">
                            <MudText Typo="Typo.h6">Start Date:</MudText>
                            <MudText Typo="Typo.body1">@_complianceProject.StartDate.ToShortDateString()</MudText>
                        </MudItem>
                        <MudItem xs="12" sm="6">
                            <MudText Typo="Typo.h6">End Date:</MudText>
                            <MudText Typo="Typo.body1">@_complianceProject.EndDate.ToShortDateString()</MudText>
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            </MudItem>

            <!-- Associated Documents Section -->
            <MudItem xs="12">
                <MudPaper Elevation="1" Class="pa-4">
                    <MudText Typo="Typo.h5">Associated Documents</MudText>
                    <MudTable Items="_complianceProject.Evidence" Dense="true" Hover="true" Class="mt-2">
                        <HeaderContent>
                            <MudTh>Document Name</MudTh>
                            <MudTh>Type</MudTh>
                            <MudTh>Date Uploaded</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd>@context.DocumentName</MudTd>
                            <MudTd>@context.DocumentType</MudTd>
                            <MudTd>@context.UploadDate.ToShortDateString()</MudTd>
                        </RowTemplate>
                    </MudTable>
                </MudPaper>
            </MudItem>
        </MudGrid>
    </MudContainer>
}

@code {
    [Parameter] 
    public Guid Id { get; set; }
    
    [Inject]
    IProjectService ProjectService { get; set; } = null!;

    private ComplianceProjectViewModel _complianceProject = null!;
    
    protected override async Task OnInitializedAsync()
    {
        _complianceProject = await ProjectService.GetProjectById(Id);
    }

    private async Task SaveChanges()
    {
        // Simulate saving data
        await Task.Delay(500);
        Snackbar.Add("Project details saved successfully.", Severity.Success);
    }
}

